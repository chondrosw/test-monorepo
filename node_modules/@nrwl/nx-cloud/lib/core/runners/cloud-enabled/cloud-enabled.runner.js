const a1_0x27cb=['map','hash','printCacheHitsMessage','defineProperty','E2EEncryption','path','tasksRunnerV2','taskId','../../file-storage/file-storage','subscribe','@nrwl/workspace/src/tasks-runner/tasks-runner-v2','./cloud-remote-cache','Executed\x20tasks\x20with\x20hashes:\x20','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','complete','cacheDirectory','submitRunMetrics','next','cacheableOperations','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','CloudRunApi','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','error','@nrwl/workspace/src/tasks-runner/life-cycle','env','waitForStoreRequestsToComplete','forEach','rxjs/internal/Subject','__esModule','../../../utilities/environment','OutputObfuscator','startRun','MessageReporter','parseCommand','getBranch','encryptionKey','note','exit','then','./cloud-run.api','obfuscate','printMessages','toISOString','done','filter','../../file-storage/e2e-encryption','CloudRemoteCache','assign','requests','extractGitSha','CloudEnabledLifeCycle','writeFileSync','FileStorage','ENCRYPTION_KEY','EndOfRunMessage','tasks-hashes-','@nrwl/workspace/src/utilities/output','anyErrors','Subject','Agent\x20wasn\x27t\x20able\x20to\x20store\x20artifacts','scan','__awaiter','output','value','catch','stringify'];(function(_0xc662dd,_0x27cb72){const _0x5b2ccb=function(_0x1be322){while(--_0x1be322){_0xc662dd['push'](_0xc662dd['shift']());}};_0x5b2ccb(++_0x27cb72);}(a1_0x27cb,0x98));const a1_0x5b2c=function(_0xc662dd,_0x27cb72){_0xc662dd=_0xc662dd-0x0;let _0x5b2ccb=a1_0x27cb[_0xc662dd];return _0x5b2ccb;};'use strict';var __awaiter=this&&this[a1_0x5b2c('0x29')]||function(_0x328bcd,_0x157748,_0x3bdaac,_0x287def){function _0x273153(_0x410f63){return _0x410f63 instanceof _0x3bdaac?_0x410f63:new _0x3bdaac(function(_0x2809ab){_0x2809ab(_0x410f63);});}return new(_0x3bdaac||(_0x3bdaac=Promise))(function(_0x2f97ee,_0xe5f174){function _0x1c887b(_0x943f30){try{_0x2dc9df(_0x287def['next'](_0x943f30));}catch(_0x37e996){_0xe5f174(_0x37e996);}}function _0x234b48(_0x48569a){try{_0x2dc9df(_0x287def['throw'](_0x48569a));}catch(_0xef4ccf){_0xe5f174(_0xef4ccf);}}function _0x2dc9df(_0x491aee){_0x491aee[a1_0x5b2c('0x17')]?_0x2f97ee(_0x491aee[a1_0x5b2c('0x2b')]):_0x273153(_0x491aee[a1_0x5b2c('0x2b')])['then'](_0x1c887b,_0x234b48);}_0x2dc9df((_0x287def=_0x287def['apply'](_0x328bcd,_0x157748||[]))[a1_0x5b2c('0x3f')]());});};Object[a1_0x5b2c('0x31')](exports,a1_0x5b2c('0x8'),{'value':!![]});exports['cloudEnabledTasksRunner']=void 0x0;const Subject_1=require(a1_0x5b2c('0x7'));const message_reporter_1=require('../../terminal-output/message-reporter');const end_of_run_message_1=require('../../terminal-output/end-of-run-message');const output_obfuscator_1=require('../../terminal-output/output-obfuscator');const cloud_enabled_life_cycle_1=require('./cloud-enabled-life-cycle');const file_storage_1=require(a1_0x5b2c('0x36'));const e2e_encryption_1=require(a1_0x5b2c('0x19'));const environment_1=require(a1_0x5b2c('0x9'));const cloud_remote_cache_1=require(a1_0x5b2c('0x39'));const tasks_runner_v2_1=require(a1_0x5b2c('0x38'));const output_1=require(a1_0x5b2c('0x24'));const cloud_run_api_1=require(a1_0x5b2c('0x13'));const fs_1=require('fs');const path=require(a1_0x5b2c('0x33'));const metric_logger_1=require('../../../utilities/metric-logger');function createApi(_0x31cc7d,_0x34a4d3,_0xd44f62){const _0xccaf6=(0x0,environment_1['getMachineInfo'])(_0x34a4d3);return new cloud_run_api_1[(a1_0x5b2c('0x0'))](_0x31cc7d,_0xd44f62,_0x34a4d3,_0xccaf6);}function storeTaskHashes(_0x4a88d4,_0x39a387,_0x297dff){const _0x2530cb=JSON[a1_0x5b2c('0x2d')](_0x4a88d4[a1_0x5b2c('0x2e')](_0x4e5f13=>({'taskId':_0x4e5f13[a1_0x5b2c('0x35')],'hash':_0x4e5f13[a1_0x5b2c('0x2f')]})));if(environment_1['VERBOSE_LOGGING']){output_1['output'][a1_0x5b2c('0x10')]({'title':a1_0x5b2c('0x3a')+_0x2530cb});}(0x0,fs_1[a1_0x5b2c('0x1f')])(path['join'](_0x39a387,a1_0x5b2c('0x23')+_0x297dff),_0x2530cb);}function onComplete(_0x2727b0,_0x42ab23,_0x21412b,_0x17cd0b,_0x12aec7,_0x558f56,_0x36b72b,_0x51f303,_0x4bd660,_0x3c8544){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3480e1=new Date()[a1_0x5b2c('0x16')]();if(environment_1['AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION']){storeTaskHashes(_0x4bd660,_0x42ab23[a1_0x5b2c('0x3d')]||'./node_modules/.cache/nx',environment_1[a1_0x5b2c('0x3b')]);}const _0x1040ab=(0x0,environment_1[a1_0x5b2c('0xe')])();const _0x354c6d=yield Promise['all']([_0x21412b[a1_0x5b2c('0x5')](),_0x17cd0b['endRun']({'command':_0x12aec7[a1_0x5b2c('0x14')]((0x0,environment_1[a1_0x5b2c('0xd')])()),'startTime':_0x558f56,'endTime':_0x3480e1,'distributedExecutionId':environment_1[a1_0x5b2c('0x3b')],'branch':_0x1040ab,'scan':!![],'runGroup':(0x0,environment_1['getRunGroup'])(),'sha':_0x1040ab?(0x0,environment_1[a1_0x5b2c('0x1d')])():undefined},_0x4bd660)]);if(_0x3c8544){setTimeout(()=>{_0x36b72b[a1_0x5b2c('0x15')]();if(!_0x36b72b[a1_0x5b2c('0x25')]){_0x51f303[a1_0x5b2c('0x30')]();}},0x0);}else{_0x36b72b[a1_0x5b2c('0x15')]();if(!_0x36b72b[a1_0x5b2c('0x25')]){_0x51f303[a1_0x5b2c('0x30')]();}}if(environment_1[a1_0x5b2c('0x1')]){if(!_0x354c6d[0x0]){output_1[a1_0x5b2c('0x2a')][a1_0x5b2c('0x2')]({'title':a1_0x5b2c('0x27')});_0x36b72b[a1_0x5b2c('0x15')]();process[a1_0x5b2c('0x11')](environment_1[a1_0x5b2c('0x41')]);}if(!_0x354c6d[0x1]){output_1['output'][a1_0x5b2c('0x2')]({'title':'Agent\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run'});_0x36b72b[a1_0x5b2c('0x15')]();process[a1_0x5b2c('0x11')](environment_1[a1_0x5b2c('0x41')]);}}yield(0x0,metric_logger_1[a1_0x5b2c('0x3e')])(_0x42ab23);});}function createLifeCycle(_0x17798a,_0x59c36a,_0xa5bc3e,_0x390814){const _0x252520=new cloud_enabled_life_cycle_1[(a1_0x5b2c('0x1e'))](_0x17798a,_0x59c36a[a1_0x5b2c('0x3d')],_0x59c36a[a1_0x5b2c('0x28')]===undefined?!![]:_0x59c36a[a1_0x5b2c('0x28')],_0x59c36a[a1_0x5b2c('0x40')]||[],_0xa5bc3e,_0x390814);try{const {CompositeLifeCycle}=require(a1_0x5b2c('0x3'));if(!CompositeLifeCycle)return _0x252520;return new CompositeLifeCycle([_0x59c36a['lifeCycle'],_0x252520]);}catch(_0x16a2da){return _0x252520;}}function cloudEnabledTasksRunner(_0x590fde,_0x3b3c22,_0x2e4460){const _0x44e279={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x590fde};const _0x5e857e=_0x3b3c22['lifeCycle']===undefined;const _0x1e3a5d=[];const _0x4fc949=new message_reporter_1[(a1_0x5b2c('0xc'))](_0x3b3c22);const _0x1533e3=createApi(_0x4fc949,_0x3b3c22,_0x44e279);const _0x446d33=new end_of_run_message_1[(a1_0x5b2c('0x22'))](_0x44e279,_0x1e3a5d);const _0x4ebcd2=new output_obfuscator_1[(a1_0x5b2c('0xa'))]();const _0x219fe2=_0x590fde[a1_0x5b2c('0x2e')](_0x1aba76=>_0x1aba76[a1_0x5b2c('0x2f')])[a1_0x5b2c('0x18')](_0x5d1f31=>!!_0x5d1f31);const _0x5833c2=_0x1533e3[a1_0x5b2c('0xb')](environment_1[a1_0x5b2c('0x3b')],_0x219fe2);_0x219fe2[a1_0x5b2c('0x6')](_0x411cd5=>{_0x44e279[a1_0x5b2c('0x1c')][_0x411cd5]=_0x5833c2;});const _0x461534=new Date()[a1_0x5b2c('0x16')]();const _0x78270e=createLifeCycle(_0x44e279,_0x3b3c22,_0x4ebcd2,_0x1e3a5d);const _0x4299bb=new e2e_encryption_1[(a1_0x5b2c('0x32'))](environment_1[a1_0x5b2c('0x21')]||_0x3b3c22[a1_0x5b2c('0xf')]);const _0x3c2906=new file_storage_1[(a1_0x5b2c('0x20'))](_0x4299bb);const _0x29a785=new cloud_remote_cache_1[(a1_0x5b2c('0x1a'))](_0x4fc949,_0x1533e3,_0x44e279,_0x3c2906);delete process[a1_0x5b2c('0x4')][a1_0x5b2c('0x3b')];const _0x3f1ad6=(0x0,tasks_runner_v2_1[a1_0x5b2c('0x34')])(_0x590fde,Object[a1_0x5b2c('0x1b')](Object[a1_0x5b2c('0x1b')]({},_0x3b3c22),{'remoteCache':_0x29a785,'lifeCycle':_0x78270e}),_0x2e4460);if(_0x3f1ad6['subscribe']){const _0x11a595=new Subject_1[(a1_0x5b2c('0x26'))]();_0x3f1ad6[a1_0x5b2c('0x37')]({'next':_0x2bbc02=>_0x11a595[a1_0x5b2c('0x3f')](_0x2bbc02),'error':_0x1e6967=>_0x11a595[a1_0x5b2c('0x2')](_0x1e6967),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0x78270e,_0x3b3c22,_0x29a785,_0x1533e3,_0x4ebcd2,_0x461534,_0x4fc949,_0x446d33,_0x1e3a5d,_0x5e857e);_0x11a595[a1_0x5b2c('0x3c')]();})});return _0x11a595;}else{return _0x3f1ad6[a1_0x5b2c('0x12')](_0x4ade94=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0x78270e,_0x3b3c22,_0x29a785,_0x1533e3,_0x4ebcd2,_0x461534,_0x4fc949,_0x446d33,_0x1e3a5d,_0x5e857e);return _0x4ade94;}))[a1_0x5b2c('0x2c')](_0x528315=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0x78270e,_0x3b3c22,_0x29a785,_0x1533e3,_0x4ebcd2,_0x461534,_0x4fc949,_0x446d33,_0x1e3a5d,_0x5e857e);throw _0x528315;}));}}exports['cloudEnabledTasksRunner']=cloudEnabledTasksRunner;