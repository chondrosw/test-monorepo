const a5_0x4b98=[').\x20Tasks\x20hashes\x20haven\x27t\x20been\x20recorded.','Waiter','completedTasks','NX_AGENT_NAME','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.','value','Other\x20Nx\x20Cloud\x20Agents\x20Detected','catch','/lockfiles','readdirSync','maxParallel','projects','Command\x20execution\x20failed\x20(distributed\x20task\x20execution:\x20','execSync','Duplicate\x20Agent\x20ID\x20Detected','writeFileSync','target','/tasks-hashes-','true','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks','startAgent','\x20--parallel\x20--max-parallel=','retryDuring:\x20','error:\x20','taskId','../../../utilities/environment','params','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.','VERBOSE_LOGGING','toString','executionId','Waiting...','\x20--projects=','strip-json-comments','apply','tasksRunnerOptions','completedStatusCode','options','unlinkSync','../../../utilities/waiter','number\x20of\x20tasks:\x20','random','printRunGroupError','nx.json','createNoNewMessagesTimeout','__esModule','./node_modules/.cache/nx','env','existsSync','status','We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.','length','Error:','readFileSync','We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','floor','inherit','.lock','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','npx\x20nx\x20run-many\x20--target=','completeRunGroupWithError','../../error/print-run-group-error','Distributed\x20Execution\x20Terminated','configuration','join','completed','note','child_process','getRunGroup','wait','@nrwl/workspace/src/utilities/output','completed:\x20','Fetching\x20tasks...','map','error','DistributedAgentApi','maxParallel:\x20','CIRCLECI','getTime','throw','exit','retryDuring','defineProperty','default','../../../utilities/metric-logger','./distributed-agent.api','cacheDirectory','criticalErrorMessage','tasks','done','assign','projectName','push','Agent\x20','parse','API\x20Response','../../../utilities/create-no-new-messages-timeout','output','reset','next','then','message','SIGINT'];(function(_0x3079bb,_0x4b9859){const _0x3de660=function(_0x5278d1){while(--_0x5278d1){_0x3079bb['push'](_0x3079bb['shift']());}};_0x3de660(++_0x4b9859);}(a5_0x4b98,0x12f));const a5_0x3de6=function(_0x3079bb,_0x4b9859){_0x3079bb=_0x3079bb-0x0;let _0x3de660=a5_0x4b98[_0x3079bb];return _0x3de660;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x292e2c,_0x12e015,_0x522286,_0x3a3854){function _0x24fb9a(_0x1ea12c){return _0x1ea12c instanceof _0x522286?_0x1ea12c:new _0x522286(function(_0x130ec1){_0x130ec1(_0x1ea12c);});}return new(_0x522286||(_0x522286=Promise))(function(_0x43e51a,_0x2bd246){function _0x507f49(_0x1e90da){try{_0x3a5729(_0x3a3854[a5_0x3de6('0x2')](_0x1e90da));}catch(_0x5d44d){_0x2bd246(_0x5d44d);}}function _0x340880(_0x205b34){try{_0x3a5729(_0x3a3854[a5_0x3de6('0x55')](_0x205b34));}catch(_0x57d4f5){_0x2bd246(_0x57d4f5);}}function _0x3a5729(_0x3e952d){_0x3e952d[a5_0x3de6('0x5f')]?_0x43e51a(_0x3e952d['value']):_0x24fb9a(_0x3e952d[a5_0x3de6('0xb')])['then'](_0x507f49,_0x340880);}_0x3a5729((_0x3a3854=_0x3a3854[a5_0x3de6('0x28')](_0x292e2c,_0x12e015||[]))[a5_0x3de6('0x2')]());});};Object[a5_0x3de6('0x58')](exports,a5_0x3de6('0x33'),{'value':!![]});exports['startAgent']=void 0x0;const output_1=require(a5_0x3de6('0x4c'));const child_process_1=require(a5_0x3de6('0x49'));const stripJsonComments=require(a5_0x3de6('0x27'));const distributed_agent_api_1=require(a5_0x3de6('0x5b'));const waiter_1=require(a5_0x3de6('0x2d'));const environment_1=require(a5_0x3de6('0x1f'));const print_run_group_error_1=require(a5_0x3de6('0x43'));const create_no_new_messages_timeout_1=require(a5_0x3de6('0x66'));const fs_1=require('fs');const metric_logger_1=require(a5_0x3de6('0x5a'));function executeTasks(_0x3b9c0b,_0x22fb9f){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x263a30=0x0;let _0x30897d=null;const _0xf9d8b4=(0x0,create_no_new_messages_timeout_1[a5_0x3de6('0x32')])();const _0x3cde61=new waiter_1[(a5_0x3de6('0x7'))]();let _0x5cf14e=[];const _0x514fd7=new Date();let _0x402149=![];while(!![]){if(environment_1[a5_0x3de6('0x22')]){output_1['output'][a5_0x3de6('0x48')]({'title':a5_0x3de6('0x4e')});}_0x30897d=yield _0x22fb9f[a5_0x3de6('0x5e')](_0x30897d?_0x30897d['executionId']:null,_0x263a30,_0x5cf14e);if(environment_1[a5_0x3de6('0x22')]){output_1[a5_0x3de6('0x0')]['note']({'title':a5_0x3de6('0x65'),'bodyLines':[a5_0x3de6('0x4d')+_0x30897d[a5_0x3de6('0x47')],a5_0x3de6('0x1c')+_0x30897d['retryDuring'],'executionId:\x20'+_0x30897d[a5_0x3de6('0x24')],a5_0x3de6('0x2e')+_0x30897d[a5_0x3de6('0x5e')][a5_0x3de6('0x39')],a5_0x3de6('0x1d')+_0x30897d[a5_0x3de6('0x5d')],a5_0x3de6('0x52')+_0x30897d[a5_0x3de6('0x10')]]});}if(_0x30897d[a5_0x3de6('0x5d')]){output_1[a5_0x3de6('0x0')][a5_0x3de6('0x50')]({'title':a5_0x3de6('0x44'),'bodyLines':[a5_0x3de6('0x3a'),_0x30897d[a5_0x3de6('0x5d')]]});process[a5_0x3de6('0x56')](0x0);}if((_0x30897d===null||_0x30897d===void 0x0?void 0x0:_0x30897d[a5_0x3de6('0x57')])&&(_0x30897d===null||_0x30897d===void 0x0?void 0x0:_0x30897d['retryDuring'])!==0x0&&!_0x402149&&new Date()[a5_0x3de6('0x54')]()-_0x514fd7[a5_0x3de6('0x54')]()>_0x30897d['retryDuring']){yield _0x3cde61[a5_0x3de6('0x4b')]();continue;}if(_0x30897d[a5_0x3de6('0x47')])return;_0xf9d8b4(_0x30897d[a5_0x3de6('0x5e')][a5_0x3de6('0x4f')](_0x6320ed=>_0x6320ed[a5_0x3de6('0x1e')])[a5_0x3de6('0x46')](''));if(!_0x30897d[a5_0x3de6('0x24')]){if(environment_1[a5_0x3de6('0x22')]){output_1[a5_0x3de6('0x0')][a5_0x3de6('0x48')]({'title':a5_0x3de6('0x25')});}yield _0x3cde61[a5_0x3de6('0x4b')]();_0x263a30=0x0;_0x5cf14e=[];continue;}_0x3cde61[a5_0x3de6('0x1')]();_0x402149=!![];const _0x1916e2=invokeTasksUsingRunMany(_0x3b9c0b,_0x30897d[a5_0x3de6('0x24')],_0x30897d['tasks'],_0x30897d[a5_0x3de6('0x10')]);_0x263a30=_0x1916e2[a5_0x3de6('0x2a')];_0x5cf14e=_0x1916e2[a5_0x3de6('0x8')];}});}function readCompletedTasks(_0x5e09cc,_0xb6850b){const _0x1d66b4=a5_0x3de6('0x12')+_0xb6850b+a5_0x3de6('0x6');let _0x15dbf5;try{const _0x558b26=_0x5e09cc[a5_0x3de6('0x5c')]||a5_0x3de6('0x34');const _0x1efc56=_0x558b26+a5_0x3de6('0x17')+_0xb6850b;_0x15dbf5=JSON[a5_0x3de6('0x64')]((0x0,fs_1[a5_0x3de6('0x3b')])(_0x1efc56)[a5_0x3de6('0x23')]());(0x0,fs_1[a5_0x3de6('0x2c')])(_0x1efc56);}catch(_0x174c13){throw new Error(_0x1d66b4);}if(_0x15dbf5['length']==0x0){throw new Error(_0x1d66b4);}return _0x15dbf5;}function invokeTasksUsingRunMany(_0x1c48f4,_0x41be78,_0x2c0e2a,_0x21ffa5){let _0x256edb=0x0;const _0x3815ff=[];for(const _0x594155 of groupByTarget(_0x2c0e2a)){const _0x35c2f6=_0x594155[a5_0x3de6('0x45')]?'--configuration='+_0x594155[a5_0x3de6('0x45')]:'';const _0x1d7ff7=_0x21ffa5>0x1?a5_0x3de6('0x1b')+_0x21ffa5:'';const _0x248c70=a5_0x3de6('0x41')+_0x594155[a5_0x3de6('0x16')]+'\x20'+_0x35c2f6+a5_0x3de6('0x26')+_0x594155[a5_0x3de6('0x11')]['join'](',')+'\x20'+_0x594155['params']+_0x1d7ff7;if(environment_1[a5_0x3de6('0x22')]){output_1[a5_0x3de6('0x0')][a5_0x3de6('0x48')]({'title':'Executing:\x20\x27'+_0x248c70+'\x27'});}try{(0x0,child_process_1[a5_0x3de6('0x13')])(_0x248c70,{'stdio':['inherit',a5_0x3de6('0x3e'),a5_0x3de6('0x3e')],'env':Object[a5_0x3de6('0x60')](Object[a5_0x3de6('0x60')]({},process[a5_0x3de6('0x35')]),{'NX_CACHE_FAILURES':a5_0x3de6('0x18'),'NX_CLOUD_DISTRIBUTED_EXECUTION_ID':_0x41be78})});}catch(_0x2908d2){if(_0x2908d2[a5_0x3de6('0x37')]===environment_1[a5_0x3de6('0x40')]){throw _0x2908d2;}else{_0x256edb=0x1;}}finally{_0x3815ff[a5_0x3de6('0x62')](...readCompletedTasks(_0x1c48f4,_0x41be78));}}return{'completedStatusCode':_0x256edb,'completedTasks':_0x3815ff};}function groupByTarget(_0x381f38){const _0x1b1a78=[];_0x381f38['forEach'](_0x32e3f2=>{const _0x57152d=_0x1b1a78['find'](_0x3d4116=>_0x3d4116[a5_0x3de6('0x16')]===_0x32e3f2['target']&&_0x3d4116[a5_0x3de6('0x45')]===_0x32e3f2['configuration']);if(_0x57152d){_0x57152d[a5_0x3de6('0x11')][a5_0x3de6('0x62')](_0x32e3f2[a5_0x3de6('0x61')]);}else{_0x1b1a78[a5_0x3de6('0x62')]({'target':_0x32e3f2[a5_0x3de6('0x16')],'projects':[_0x32e3f2[a5_0x3de6('0x61')]],'params':_0x32e3f2[a5_0x3de6('0x20')],'configuration':_0x32e3f2['configuration']});}});return _0x1b1a78;}function getAgentName(){if(process[a5_0x3de6('0x35')][a5_0x3de6('0x9')]!==undefined){return process[a5_0x3de6('0x35')]['NX_AGENT_NAME'];}else if(process[a5_0x3de6('0x35')][a5_0x3de6('0x53')]!==undefined){return process[a5_0x3de6('0x35')]['CIRCLE_STAGE'];}else{return a5_0x3de6('0x63')+Math[a5_0x3de6('0x3d')](Math[a5_0x3de6('0x2f')]()*0x186a0);}}function createAgentLockfile(_0x4beb0a,_0x22a9e7){const _0x1d614d=_0x4beb0a[a5_0x3de6('0x5c')]||a5_0x3de6('0x34');const _0x4497b9=_0x1d614d+a5_0x3de6('0xe');const _0x2f9430=_0x4497b9+'/'+_0x22a9e7+a5_0x3de6('0x3f');if(!(0x0,fs_1[a5_0x3de6('0x36')])(_0x4497b9)){(0x0,fs_1['mkdirSync'])(_0x4497b9,{'recursive':!![]});}const _0x24069c=(0x0,fs_1[a5_0x3de6('0xf')])(_0x4497b9);if(_0x24069c[a5_0x3de6('0x39')]){if(_0x24069c['includes'](_0x22a9e7+'.lock')){output_1[a5_0x3de6('0x0')][a5_0x3de6('0x50')]({'title':a5_0x3de6('0x14'),'bodyLines':[a5_0x3de6('0x38'),'',a5_0x3de6('0xa')]});process[a5_0x3de6('0x56')](0x1);}output_1[a5_0x3de6('0x0')]['warn']({'title':a5_0x3de6('0xc'),'bodyLines':[a5_0x3de6('0x3c'),'','This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.',a5_0x3de6('0x21')]});}(0x0,fs_1[a5_0x3de6('0x15')])(_0x2f9430,'');process['on'](a5_0x3de6('0x56'),()=>cleanupAgentLockfile(_0x2f9430));process['on'](a5_0x3de6('0x5'),()=>cleanupAgentLockfile(_0x2f9430));}function cleanupAgentLockfile(_0x1a83b0){if((0x0,fs_1[a5_0x3de6('0x36')])(_0x1a83b0)){(0x0,fs_1[a5_0x3de6('0x2c')])(_0x1a83b0);}}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x401f3a=(0x0,environment_1[a5_0x3de6('0x4a')])();if(!_0x401f3a){(0x0,print_run_group_error_1[a5_0x3de6('0x30')])();return process[a5_0x3de6('0x56')](0x1);}output_1[a5_0x3de6('0x0')]['note']({'title':a5_0x3de6('0x19')});const _0x1b028c=JSON[a5_0x3de6('0x64')](stripJsonComments((0x0,fs_1[a5_0x3de6('0x3b')])(a5_0x3de6('0x31'))[a5_0x3de6('0x23')]()))[a5_0x3de6('0x29')][a5_0x3de6('0x59')][a5_0x3de6('0x2b')];const _0xfab550=getAgentName();createAgentLockfile(_0x1b028c,_0xfab550);const _0x5483a4=new distributed_agent_api_1[(a5_0x3de6('0x51'))](_0x1b028c,_0x401f3a,_0xfab550);return executeTasks(_0x1b028c,_0x5483a4)[a5_0x3de6('0x3')](_0x4f515d=>__awaiter(this,void 0x0,void 0x0,function*(){yield(0x0,metric_logger_1['submitRunMetrics'])(_0x1b028c);return _0x4f515d;}))[a5_0x3de6('0xd')](_0x1219c0=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x5483a4[a5_0x3de6('0x42')]('Critical\x20Error\x20in\x20Agent:\x20\x22'+_0x1219c0[a5_0x3de6('0x4')]+'\x22');throw _0x1219c0;}));});}exports[a5_0x3de6('0x1a')]=startAgent;