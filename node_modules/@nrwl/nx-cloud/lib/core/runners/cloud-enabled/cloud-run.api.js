const a3_0x55c2=['promisify','parse','apiAxiosInstance','extractErrorMessage','output','Run\x20Details:','Invalid\x20end\x20run\x20response:\x20','urls','then','startRun','stack','../../../utilities/metric-logger','assign','createMetricRecorder','from','readFileSync','defaults','status','RUNNER_FAILURE_PERF_ENTRY','Run\x20completion\x20responded\x20with\x20`undefined`.','CloudRunApi','defineProperty','RunStart','runContext','data','runUrl','done','stringify','...','messages','value','error','axiosException','gzip','mapRespToPerfEntry','machineInfo','note','getBranch','next','recordMetric','endRun','api','apply','success','__awaiter','unknown','application/octet-stream','apiError','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','message','@nrwl/workspace/src/utilities/output','response','string','nxCloudVersion','axiosMultipleTries','util','VERBOSE_LOGGING','zlib','getRunGroup','@nrwl/nx-cloud','headers','post'];(function(_0x39c9a9,_0x55c288){const _0x525b42=function(_0x332cb8){while(--_0x332cb8){_0x39c9a9['push'](_0x39c9a9['shift']());}};_0x525b42(++_0x55c288);}(a3_0x55c2,0x156));const a3_0x525b=function(_0x39c9a9,_0x55c288){_0x39c9a9=_0x39c9a9-0x0;let _0x525b42=a3_0x55c2[_0x39c9a9];return _0x525b42;};'use strict';var __awaiter=this&&this[a3_0x525b('0xc')]||function(_0x54e109,_0x5b777e,_0x1e0448,_0x3b2053){function _0x43a6f0(_0x3e4592){return _0x3e4592 instanceof _0x1e0448?_0x3e4592:new _0x1e0448(function(_0x2e27e9){_0x2e27e9(_0x3e4592);});}return new(_0x1e0448||(_0x1e0448=Promise))(function(_0x3a9ae8,_0x392b81){function _0x45a0bd(_0x3d3fba){try{_0xc799a(_0x3b2053['next'](_0x3d3fba));}catch(_0x375124){_0x392b81(_0x375124);}}function _0x47fd19(_0x25cd21){try{_0xc799a(_0x3b2053['throw'](_0x25cd21));}catch(_0x47564b){_0x392b81(_0x47564b);}}function _0xc799a(_0x48ef6f){_0x48ef6f[a3_0x525b('0x38')]?_0x3a9ae8(_0x48ef6f['value']):_0x43a6f0(_0x48ef6f[a3_0x525b('0x3c')])[a3_0x525b('0x26')](_0x45a0bd,_0x47fd19);}_0xc799a((_0x3b2053=_0x3b2053[a3_0x525b('0xa')](_0x54e109,_0x5b777e||[]))[a3_0x525b('0x6')]());});};Object[a3_0x525b('0x33')](exports,'__esModule',{'value':!![]});exports[a3_0x525b('0x32')]=void 0x0;const output_1=require(a3_0x525b('0x12'));const axios_1=require('../../../utilities/axios');const environment_1=require('../../../utilities/environment');const fs_1=require('fs');const zlib_1=require(a3_0x525b('0x19'));const util_1=require(a3_0x525b('0x17'));const metric_logger_1=require(a3_0x525b('0x29'));class CloudRunApi{constructor(_0x1ab65f,_0x290fa3,_0x4b7d7a,_0x1789ca){this['messages']=_0x1ab65f;this[a3_0x525b('0x35')]=_0x290fa3;this[a3_0x525b('0x3')]=_0x1789ca;this[a3_0x525b('0x20')]=(0x0,axios_1['createApiAxiosInstance'])(_0x4b7d7a);}[a3_0x525b('0x27')](_0x58e755,_0x48870d){var _0x203344;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2541e8=(0x0,metric_logger_1[a3_0x525b('0x2b')])(a3_0x525b('0x27'));try{const _0xb225fd={'meta':{'nxCloudVersion':this[a3_0x525b('0x15')]()},'branch':(0x0,environment_1[a3_0x525b('0x5')])(),'runGroup':(0x0,environment_1[a3_0x525b('0x1a')])(),'distributedExecutionId':_0x58e755,'hashes':_0x48870d};if(environment_1[a3_0x525b('0x18')]){output_1[a3_0x525b('0x22')][a3_0x525b('0x4')]({'title':a3_0x525b('0x34'),'bodyLines':['\x0a'+JSON[a3_0x525b('0x39')](_0xb225fd,null,0x2)]});}const _0x3180ce=yield(0x0,axios_1[a3_0x525b('0x16')])(()=>this[a3_0x525b('0x20')][a3_0x525b('0x1d')]('/nx-cloud/runs/start',_0xb225fd));_0x2541e8[a3_0x525b('0x7')]((0x0,metric_logger_1[a3_0x525b('0x2')])(_0x3180ce));if(_0x3180ce[a3_0x525b('0x36')]&&_0x3180ce[a3_0x525b('0x36')][a3_0x525b('0x11')]){this[a3_0x525b('0x3b')][a3_0x525b('0x11')]=_0x3180ce['data'][a3_0x525b('0x11')];}if(!_0x3180ce['data']||!_0x3180ce[a3_0x525b('0x36')]['urls']){this[a3_0x525b('0x3b')]['apiError']='Invalid\x20Nx\x20Cloud\x20response:\x20'+JSON[a3_0x525b('0x39')](_0x3180ce[a3_0x525b('0x36')]);return{};}return _0x3180ce['data'][a3_0x525b('0x25')];}catch(_0x3be60b){_0x2541e8['recordMetric'](((_0x203344=_0x3be60b===null||_0x3be60b===void 0x0?void 0x0:_0x3be60b[a3_0x525b('0x0')])===null||_0x203344===void 0x0?void 0x0:_0x203344[a3_0x525b('0x13')])?(0x0,metric_logger_1[a3_0x525b('0x2')])(_0x3be60b[a3_0x525b('0x0')][a3_0x525b('0x13')]):metric_logger_1[a3_0x525b('0x30')]);this[a3_0x525b('0x3b')][a3_0x525b('0xf')]=this[a3_0x525b('0x3b')][a3_0x525b('0x21')](_0x3be60b,a3_0x525b('0x9'));return{};}});}[a3_0x525b('0x8')](_0x41cd3c,_0x2cafc3){var _0x588923,_0x20e989;return __awaiter(this,void 0x0,void 0x0,function*(){if(this['messages'][a3_0x525b('0xf')])return![];const _0x5a377e={'meta':{'nxCloudVersion':this[a3_0x525b('0x15')]()},'tasks':_0x2cafc3,'run':_0x41cd3c,'machineInfo':this['machineInfo']};const _0x3e9ecf=Buffer[a3_0x525b('0x2c')](JSON[a3_0x525b('0x39')](_0x5a377e));const _0x4463ac=yield(0x0,util_1[a3_0x525b('0x1e')])(zlib_1['gzip'])(_0x3e9ecf);const _0x34f784=(0x0,metric_logger_1[a3_0x525b('0x2b')])(a3_0x525b('0x8'));try{if(environment_1[a3_0x525b('0x18')]){const _0x5dced3=_0x2cafc3['map'](_0x2e0f1b=>{return Object['assign'](Object[a3_0x525b('0x2a')]({},_0x2e0f1b),{'terminalOutput':_0x2e0f1b['terminalOutput']?_0x2e0f1b['terminalOutput']['slice'](0x0,0x14)+a3_0x525b('0x3a'):undefined});});output_1[a3_0x525b('0x22')][a3_0x525b('0x4')]({'title':'RunEnd.\x20Completed\x20tasks','bodyLines':['\x0a'+JSON[a3_0x525b('0x39')](_0x5dced3,null,0x2)]});}const _0x373905=yield(0x0,axios_1['axiosMultipleTries'])(()=>this['apiAxiosInstance'][a3_0x525b('0x1d')]('/nx-cloud/runs/end',_0x4463ac,{'headers':Object['assign'](Object[a3_0x525b('0x2a')]({},this[a3_0x525b('0x20')][a3_0x525b('0x2e')][a3_0x525b('0x1c')]),{'Content-Encoding':a3_0x525b('0x1'),'Content-Type':a3_0x525b('0xe')})}));if(_0x373905){_0x34f784['recordMetric']((0x0,metric_logger_1[a3_0x525b('0x2')])(_0x373905));if(_0x373905[a3_0x525b('0x36')]&&_0x373905[a3_0x525b('0x36')][a3_0x525b('0x37')]&&_0x373905[a3_0x525b('0x36')][a3_0x525b('0x2f')]===a3_0x525b('0xb')){this['runContext'][a3_0x525b('0x37')]=_0x373905['data'][a3_0x525b('0x37')];return!![];}if(_0x373905[a3_0x525b('0x36')]&&_0x373905[a3_0x525b('0x36')][a3_0x525b('0x2f')]){this[a3_0x525b('0x3b')][a3_0x525b('0xf')]='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x525b('0x39')](_0x373905[a3_0x525b('0x36')][a3_0x525b('0x11')]);}else if(_0x373905[a3_0x525b('0x36')]&&typeof _0x373905[a3_0x525b('0x36')]===a3_0x525b('0x14')){if(_0x373905[a3_0x525b('0x36')]!=='success'){this[a3_0x525b('0x3b')][a3_0x525b('0xf')]=a3_0x525b('0x24')+JSON[a3_0x525b('0x39')](_0x373905[a3_0x525b('0x36')]);}}else{this['messages'][a3_0x525b('0xf')]=a3_0x525b('0x24')+JSON[a3_0x525b('0x39')](_0x373905['data']);}if(environment_1[a3_0x525b('0x18')]){output_1[a3_0x525b('0x22')]['note']({'title':'Invalid\x20end\x20run\x20response','bodyLines':[JSON[a3_0x525b('0x39')](_0x373905[a3_0x525b('0x36')],null,0x2)]});}}else{output_1[a3_0x525b('0x22')][a3_0x525b('0x3d')]({'title':a3_0x525b('0x10'),'bodyLines':[a3_0x525b('0x31'),a3_0x525b('0x23'),JSON[a3_0x525b('0x39')](_0x41cd3c,null,0x2),'Stack\x20Trace:',JSON[a3_0x525b('0x39')](new Error()[a3_0x525b('0x28')],null,0x2)]});}return![];}catch(_0x3ea7a5){_0x34f784[a3_0x525b('0x7')](((_0x588923=_0x3ea7a5===null||_0x3ea7a5===void 0x0?void 0x0:_0x3ea7a5[a3_0x525b('0x0')])===null||_0x588923===void 0x0?void 0x0:_0x588923['response'])?(0x0,metric_logger_1[a3_0x525b('0x2')])(_0x3ea7a5['axiosException'][a3_0x525b('0x13')]):metric_logger_1[a3_0x525b('0x30')]);const _0x28821d=(_0x20e989=_0x3ea7a5[a3_0x525b('0x0')])!==null&&_0x20e989!==void 0x0?_0x20e989:_0x3ea7a5;this[a3_0x525b('0x3b')][a3_0x525b('0xf')]=this[a3_0x525b('0x3b')][a3_0x525b('0x21')](_0x28821d,a3_0x525b('0x9'));return![];}});}[a3_0x525b('0x15')](){try{const _0x521ec5=JSON[a3_0x525b('0x1f')]((0x0,fs_1[a3_0x525b('0x2d')])('package.json')['toString']());return _0x521ec5['devDependencies'][a3_0x525b('0x1b')];}catch(_0x1f1e84){return a3_0x525b('0xd');}}}exports[a3_0x525b('0x32')]=CloudRunApi;